-- Question #1

CREATE TABLE EMP (
  EMP_ID INT PRIMARY KEY IDENTITY,
  NAME   VARCHAR(50),
  SALARY INT,
  DEPTNO INT FOREIGN KEY REFERENCES DEPT (DEPTNO)
    ON DELETE CASCADE
);

CREATE TABLE DEPT (
  DEPTNO    INT PRIMARY KEY,
  DEPT_NAME VARCHAR(50)
);

INSERT INTO DEPT VALUES (1, 'inventory');
INSERT INTO DEPT VALUES (2, 'sales');
INSERT INTO DEPT VALUES (3, 'mgmt');
INSERT INTO DEPT VALUES (4, 'finance');
INSERT INTO DEPT VALUES (5, 'support');
INSERT INTO DEPT VALUES (6, 'CS');

INSERT INTO EMP (NAME, SALARY, DEPTNO) VALUES ('hassan', 100, 1);
INSERT INTO EMP (NAME, SALARY, DEPTNO) VALUES ('taghi', 200, 1);
INSERT INTO EMP (NAME, SALARY, DEPTNO) VALUES ('ebi', 1000, 1);
INSERT INTO EMP (NAME, SALARY, DEPTNO) VALUES ('A', 100, 1);
INSERT INTO EMP (NAME, SALARY, DEPTNO) VALUES ('D', 200, 1);
INSERT INTO EMP (NAME, SALARY, DEPTNO) VALUES ('E', 1000, 1);
INSERT INTO EMP (NAME, SALARY, DEPTNO) VALUES ('F', 150, 1);
INSERT INTO EMP (NAME, SALARY, DEPTNO) VALUES ('G', 100, 1);
INSERT INTO EMP (NAME, SALARY, DEPTNO) VALUES ('H', 100, 1);
INSERT INTO EMP (NAME, SALARY, DEPTNO) VALUES ('I', 100, 1);
INSERT INTO EMP (NAME, SALARY, DEPTNO) VALUES ('J', 100, 1);
INSERT INTO EMP (NAME, SALARY, DEPTNO) VALUES ('K', 120, 2);
INSERT INTO EMP (NAME, SALARY, DEPTNO) VALUES ('L', 150, 2);
INSERT INTO EMP (NAME, SALARY, DEPTNO) VALUES ('M', 150, 2);
INSERT INTO EMP (NAME, SALARY, DEPTNO) VALUES ('N', 150, 2);
INSERT INTO EMP (NAME, SALARY, DEPTNO) VALUES ('O', 200, 2);
INSERT INTO EMP (NAME, SALARY, DEPTNO) VALUES ('P', 120, 2);
INSERT INTO EMP (NAME, SALARY, DEPTNO) VALUES ('manager', 10000, 3);

SELECT
  NAME,
  DEPTNO
FROM EMP;

SELECT *
FROM EMP;

SELECT *
FROM DEPT;

SELECT EMP.*
FROM EMP
  JOIN DEPT ON EMP.DEPTNO = DEPT.DEPTNO;

SELECT *
FROM DEPT
WHERE DEPT.DEPTNO NOT IN (
  SELECT DEPT.DEPTNO
  FROM EMP
    JOIN DEPT ON EMP.DEPTNO = DEPT.DEPTNO
);

SELECT
  EMP.NAME,
  EMP.SALARY
FROM EMP, (SELECT MAX(EMP.SALARY) AS SSALARY
           FROM EMP
             JOIN DEPT ON EMP.DEPTNO = DEPT.DEPTNO
           GROUP BY EMP.DEPTNO) AS T
WHERE EMP.SALARY = T.SSALARY

-- Question #2

CREATE TABLE EMP_TABLE (
  EMP_ID     INT PRIMARY KEY,
  FNAME      VARCHAR(50) NOT NULL,
  LNAME      VARCHAR(50) NOT NULL,
  ADDRESS    VARCHAR(256),
  SALARY     INT DEFAULT (0),
  DEPARTMENT VARCHAR(25),
  CHECK (SALARY >= 0)
);

SELECT *
FROM EMP_TABLE

INSERT INTO EMP_TABLE (EMP_ID, FNAME, LNAME, ADDRESS, SALARY, DEPARTMENT)
VALUES (1, 'Ali', 'Hassani', 'Tehran', 1000, 'Inventory');
INSERT INTO EMP_TABLE (EMP_ID, FNAME, LNAME, SALARY, DEPARTMENT)
VALUES (2, 'Kord', 'Ghaiur', 900, 'Sale');
INSERT INTO EMP_TABLE (EMP_ID, FNAME, LNAME)
VALUES (3, 'Big', 'Foo');
INSERT INTO EMP_TABLE (EMP_ID, FNAME, LNAME, SALARY, DEPARTMENT)
VALUES (4, 'Kord', 'BATMAN', 900, 'Sale');
INSERT INTO EMP_TABLE (EMP_ID, FNAME, LNAME, SALARY, DEPARTMENT)
VALUES (5, 'Ansar', 'BATMAN', 900, 'Sale'); 

UPDATE EMP_TABLE
SET ADDRESS = 'Iran ' + upper(left(ADDRESS, 1)) +
              substring(ADDRESS, 2, len(ADDRESS))
WHERE ADDRESS IS NOT NULL;

SELECT
  FNAME + ' ' + LNAME,
  ISNULL(ADDRESS, 'UNKNOWN')
FROM EMP_TABLE
ORDER BY FNAME DESC, LNAME DESC

SELECT LNAME
FROM (SELECT DISTINCT (LNAME)
      FROM EMP_TABLE) as E
ORDER BY LEN(LNAME)